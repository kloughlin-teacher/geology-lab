<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MiniCraft Geology Studio - Stable Version</title>
<style>
body {
  font-family: Arial, sans-serif;
  background:#eef3f8;
  text-align:center;
}

canvas {
  border:2px solid black;
  background:#cce7f2;
  cursor:pointer;
}

button {
  margin:4px;
  padding:6px;
}

#vocabResult {
  margin-top:10px;
  font-weight:bold;
}

#instructions {
  font-size:14px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<h1>MiniCraft Geology Studio</h1>

<div id="instructions">
Click blocks to build upward. Drag to build continuously.
</div>

Student Name:
<input type="text" id="studentName">

<br><br>

<button onclick="setBlock('crust')">Crust</button>
<button onclick="setBlock('mantle')">Mantle</button>
<button onclick="setBlock('magma')">Magma</button>
<button onclick="setBlock('rock')">Rock</button>
<button onclick="setBlock('eraser')">Eraser</button>

<br>

<button onclick="simulateCollision()">Collision Simulation</button>
<button onclick="simulateDivergent()">Divergent Simulation</button>
<button onclick="toggleCutaway()">Earth Cutaway Mode</button>
<button onclick="checkVocabulary()">Check Vocabulary</button>

<br><br>

<canvas id="grid" width="900" height="500"></canvas>

<div id="vocabResult"></div>

<script>

const canvas = document.getElementById("grid");
const ctx = canvas.getContext("2d");

const cols = 15;
const rows = 10;
const cellSize = 50;

let grid = [];
let gridTypes = [];
let currentBlock = "crust";
let dragging = false;
let cutaway = false;

const colors = {
  crust:"#8B4513",
  mantle:"#CD853F",
  magma:"#FF4500",
  rock:"#808080"
};

const vocabList = [
  "subduction",
  "magma",
  "crust",
  "mantle",
  "erosion",
  "weathering",
  "epicenter",
  "fault"
];

function initGrid(){
  for(let r=0;r<rows;r++){
    grid[r]=[];
    gridTypes[r]=[];
    for(let c=0;c<cols;c++){
      grid[r][c]=0;
      gridTypes[r][c]=[];
    }
  }
}

function drawGrid(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(cutaway){
    drawCutaway();
    return;
  }

  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      ctx.strokeStyle = "#aaa";
      ctx.strokeRect(c*cellSize, r*cellSize, cellSize, cellSize);

      if(grid[r][c] > 0){
        ctx.fillStyle = gridTypes[r][c][gridTypes[r][c].length-1];
        ctx.fillRect(c*cellSize+5, r*cellSize+5, cellSize-10, cellSize-10);

        ctx.fillStyle="white";
        ctx.font="12px Arial";
        ctx.fillText(grid[r][c], c*cellSize+cellSize/2-5, r*cellSize+cellSize/2+4);
      }
    }
  }
}

function setBlock(type){
  currentBlock = type;
}

canvas.addEventListener("mousedown", ()=>dragging=true);
canvas.addEventListener("mouseup", ()=>dragging=false);
canvas.addEventListener("mousemove", function(e){
  if(dragging) placeBlock(e);
});
canvas.addEventListener("click", placeBlock);

function placeBlock(e){
  if(cutaway) return;

  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  const col = Math.floor(x / cellSize);
  const row = Math.floor(y / cellSize);

  if(row>=0 && row<rows && col>=0 && col<cols){
    if(currentBlock==="eraser"){
      if(grid[row][col]>0){
        grid[row][col]--;
        gridTypes[row][col].pop();
      }
    } else {
      grid[row][col]++;
      gridTypes[row][col].push(colors[currentBlock]);
    }
  }

  drawGrid();
}

function simulateCollision(){
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols-1;c++){
      if(grid[r][c]>0 && grid[r][c+1]>0){
        grid[r][c]++;
        grid[r][c+1]++;
      }
    }
  }
  drawGrid();
}

function simulateDivergent(){
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      if(grid[r][c]>0){
        grid[r][c]++;
        gridTypes[r][c].push(colors["magma"]);
      }
    }
  }
  drawGrid();
}

function toggleCutaway(){
  cutaway = !cutaway;
  drawGrid();
}

function drawCutaway(){
  ctx.fillStyle="#8B4513";
  ctx.fillRect(200,50,400,40);
  ctx.fillStyle="#CD853F";
  ctx.fillRect(200,90,400,150);
  ctx.fillStyle="#FF8C00";
  ctx.fillRect(200,240,400,100);
  ctx.fillStyle="#FFD700";
  ctx.fillRect(200,340,400,80);

  ctx.fillStyle="black";
  ctx.font="16px Arial";
  ctx.fillText("Crust",620,80);
  ctx.fillText("Mantle",620,160);
  ctx.fillText("Outer Core",620,280);
  ctx.fillText("Inner Core",620,390);
}

function checkVocabulary(){
  let text = prompt("Paste your explanation text here:");
  let found = [];

  vocabList.forEach(v=>{
    if(text && text.toLowerCase().includes(v)){
      found.push(v);
    }
  });

  if(found.length >= 3){
    document.getElementById("vocabResult").innerText =
      "Strong vocabulary use: " + found.join(", ");
  } else {
    document.getElementById("vocabResult").innerText =
      "Add more scientific vocabulary.";
  }
}

initGrid();
drawGrid();

</script>

</body>
</html>
